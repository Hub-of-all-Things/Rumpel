<!--
  ~ Copyright (C) 2016 HAT Data Exchange Ltd - All Rights Reserved
  ~ This Source Code Form is subject to the terms of the Mozilla Public
  ~ License, v. 2.0. If a copy of the MPL was not distributed with this
  ~ file, You can obtain one at http://mozilla.org/MPL/2.0/.
  ~ Written by Augustinas Markevicius <augustinas.markevicius@hatdex.org> 2016
  -->

<div class="navbar smaller">
  <div class="container-fluid">


    <div class="navbar-collapse" id="navbar-main">
      <ul class="nav navbar-nav navbar-right">


      <li class="user-nav help"><a (click)="showInfoModal()"><i class="material-icons">help_outline</i><span>Help</span></a></li>

      <li class="user-nav account" *ngIf="userAuthenticated">
        <div class="user-photo">
          <img [src]="profile.photo.url ? profile.photo.url : '/assets/icons/user-account-icon.svg'">
          <span class="badge notif-badge" *ngIf="unreadNotifications">{{unreadNotifications}}</span>
        </div>


        <div class="account-actions">
          <div class="btn-group">
            <div class="btn btn-secondary btn-lg dropdown-toggle account-btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <h6 class="welcome">Welcome {{profile.first_name}}<br><span>Last login: {{accountStatus?.previousLogin}}</span></h6>
              <div class="account-options"><i class="material-icons">keyboard_arrow_down</i></div>
            </div>
            <div class="dropdown-menu">

              <div class="accountDetails user-photo">
                <img [src]="profile.photo.url ? profile.photo.url : '/assets/icons/user-account-icon-blue.svg'">
                <h6 class="welcome">{{profile?.hatId}}<br><span>&#46;{{profile?.domain}}</span></h6>
              </div>

              <div class="accountUsage">
                  <div class="bar-container"><div class="bar" [style.width]="[accountStatus?.databaseStorageUsedShare.metric + accountStatus?.databaseStorageUsedShare.units]"></div></div>
                  <h6>{{accountStatus?.databaseStorageUsedShare.metric}}{{accountStatus?.databaseStorageUsedShare.units}} of {{round(accountStatus?.databaseStorage.metric, 2)}} {{accountStatus?.databaseStorage.units}} storage used</h6>
              </div>

              <div class="dropdown-divider"></div>

              <a class="dropdown-item" *ngIf="config.native"
                 [routerLink]="['/datastore']">Public profile</a>

              <a class="dropdown-item" *ngIf="config.native">
                Notifications<span class="badge" style="margin-top: 0;" *ngIf="unreadNotifications">{{unreadNotifications}}</span></a>

              <a class="dropdown-item" *ngIf="config.native"
                 [routerLink]="['/user', 'password', 'change']">Change password</a>

              <div class="dropdown-divider" *ngIf="config.native"></div>

              <a class="dropdown-item" (click)="signOut()">Logout <span><i class="material-icons">exit_to_app</i></span></a>
            </div>
          </div>

        </div>
      </li>

      <li class="user-nav account" *ngIf="!userAuthenticated">
        <div class="user-photo">
          <img class="notlogged" [src]="'/assets/icons/user-account-icon.svg'">
        </div>


        <div class="account-actions">
          <div class="btn-group">
            <button class="btn btn-secondary btn-lg dropdown-toggle account-btn" type="button" [routerLink]="['/user', 'login']">
              <h6>Sign in</h6>
            </button>
          </div>

        </div>
      </li>

      </ul>
    </div>
  </div>
</div>

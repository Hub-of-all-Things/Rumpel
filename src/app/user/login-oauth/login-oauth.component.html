<!--
  ~ Copyright (C) 2017 HAT Data Exchange Ltd - All Rights Reserved
  ~ This Source Code Form is subject to the terms of the Mozilla Public
  ~ License, v. 2.0. If a copy of the MPL was not distributed with this
  ~ file, You can obtain one at http://mozilla.org/MPL/2.0/.
  ~ Written by Augustinas Markevicius <augustinas.markevicius@hatdex.org> 4, 2017
  -->

<ng-container *ngIf="hatApp else loading">
  <div class="content-wrapper">
    <section class="title-section">
      <div class="app-logo-wrapper">
        <img src="{{hatApp.info.graphics.logo.normal}}" class="app-logo" height="120" width="120" />
      </div>

      <h3 class="title-section-heading">{{hatApp.info.name}}</h3>

      <p class="title-section-text">{{hatApp.info.name}} needs access to some of your HAT data, and will have the
      ability to take actions in your HAT. By agreeing, you confirm that you're okay with this.</p>
    </section>

    <section class="permissions-section">
      <h4 class="section-header">{{hatApp.info.name}} will be able to:</h4>
      <mat-card *ngFor="let role of hatApp.permissions.rolesGranted">
        <h5 class="card-heading">{{role.role.replace('namespace', '')}} Access</h5>
        <p class="card-text">The app needs to be able to {{role.role}} data in the {{role.detail}} namespace.</p>
      </mat-card>
    </section>

    <section class="permissions-section">
      <h4 class="section-header">{{hatApp.info.name}} will have access to:</h4>
      <mat-card *ngFor="let endpoint of hatApp.permissions.dataRequired.bundle.bundle | unbundle">
        <h5 class="card-heading">{{endpoint.title}}</h5>
        <div class="card-text" [class.card-text-expanded]="endpoint.expanded">
          <h6 class="card-subheading">Fields required</h6>
          <ul class="card-list">
            <li *ngFor="let field of endpoint.fields">{{field}}</li>
          </ul>
        </div>
        <div (click)="toggleCardExpansion(endpoint)" class="card-expansion-toggle">
          {{endpoint.expanded ? 'Less' : 'More'}}
        </div>
      </mat-card>
    </section>
  </div>

  <div class="user-actions">
    <button mat-flat-button role="button" (click)="agreeTerms(hatApp.id)">Agree</button>
    <button mat-flat-button role="link" (click)="declineTerms()">Cancel</button>
  </div>

</ng-container>

<ng-template #loading>
  <div class="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading permissions</div>
  </div>
</ng-template>

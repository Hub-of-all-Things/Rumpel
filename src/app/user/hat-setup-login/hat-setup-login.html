<!--
  ~ Copyright (C) 2017 - 2019 DataSwift Ltd - All Rights Reserved
  ~ This Source Code Form is subject to the terms of the Mozilla Public
  ~ License, v. 2.0. If a copy of the MPL was not distributed with this
  ~ file, You can obtain one at http://mozilla.org/MPL/2.0/.
  ~ Written by Augustinas Markevicius <augustinas.markevicius@dataswift.io> 4, 2017
  -->

<ng-container *ngIf="hatApp || errorMessage else loading">
  <ng-container *ngIf="hatApp">
    <div class="content-wrapper">
      <section class="drp-explainer">
        <h3 class="section-heading" style="margin: 32px auto;">{{hatAddress}}</h3>

        <ng-container *ngIf="hatExists; else hatNotExists">
          <p class="section-text">Our friends at {{hatApp.application.developer.name}} have requested access to your Personal Data Account with the above URL.</p>
        </ng-container>

        <ng-template #hatNotExists>
          <p class="section-text">Our friends at {{hatApp.application.developer.name}} have requested for a Personal Data Account
            to be created with the above URL. Check your email for more details.</p>
        </ng-template>
      </section>

      <div class="section-divider"></div>

      <rum-hmi-daas-content [app]="hatApp" [dependencyApps]="dependencyApps"></rum-hmi-daas-content>
    </div>

    <div class="sticky-action-panel">
      <div class="sticky-action-panel-content">
        <div class="action-buttons">
          <button mat-flat-button role="button" (click)="declineTerms()" class="secondary-action">Cancel</button>
          <button mat-flat-button role="button" (click)="agreeTerms(hatApp.application.id)" class="primary-action">Confirm</button>
        </div>
        <p class="hmi-id-text">HMI ID: {{hatApp.application.id}}-v{{hatApp.application.info.version}}</p>
        <p class="tos-text">By pressing ‘Confirm’ I agree to Dataswift Ltd
          <a href="https://cdn.dataswift.io/legal/dataswift-privacy-policy.pdf" target="_blank" style="color: #6297b1;">Privacy Policy</a>
          and the HAT
          <a href="https://cdn.dataswift.io/legal/hat-owner-terms-of-service.pdf" target="_blank" style="color: #6297b1;">Terms of Service</a>
          </p>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="errorMessage">
    <div class="app-error">
      <h3 class="app-error-header">Ooops... Looks like something went wrong.</h3>
      <p class="app-error-text">{{errorMessage}}</p>
    </div>
  </ng-container>

</ng-container>

<ng-template #loading>
  <div class="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading permissions</div>
  </div>
</ng-template>

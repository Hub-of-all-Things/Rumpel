<!--
  ~ Copyright (C) 2017 HAT Data Exchange Ltd - All Rights Reserved
  ~ This Source Code Form is subject to the terms of the Mozilla Public
  ~ License, v. 2.0. If a copy of the MPL was not distributed with this
  ~ file, You can obtain one at http://mozilla.org/MPL/2.0/.
  ~ Written by Augustinas Markevicius <augustinas.markevicius@hatdex.org> 3, 2017
  -->

<div class="container-fluid view-body">
  <div class="row">
    <div class="responsive header-strip">
      <div class="logo"></div>
      <p>Change password</p>
    </div>
  </div>

  <div class="row">
    <form class="responsive" (submit)="onSubmit(f)" #f="ngForm">
      <div class="form-group" *ngIf="!resetToken" [class.has-error]="unauthorizedError">
        <label for="currentPassword" hidden>Please enter your HAT password</label>
        <input type="password" class="form-control input-rump lg" id="currentPassword"
               (focus)="clearErrors()"
               ngModel name="currentPassword"
               placeholder="Current Password">

        <div *ngIf="unauthorizedError" class="error alert alert-danger">
          ERROR: Current password incorrect.
        </div>
      </div>

      <div class="form-group" [class.has-error]="strengthError">
        <label for="newPassword" hidden>Please enter your HAT password</label>
        <input type="password" class="form-control input-rump lg" id="newPassword"
               (focus)="clearErrors()"
               (keyup)="analysePassword(f)"
               ngModel name="newPassword"
               placeholder="New Password">
        <div class="password-strength-indicator" *ngIf="passwordStrength">
          <div class="indicator-bar" *ngFor="let barId of [0, 1, 2, 3, 4]"
               [style.background-color]="barId > passwordStrength.score ? '#c7c7c7' : colorMapping[passwordStrength.score]"></div>
        </div>
        <div class="password-strength-description" *ngIf="passwordStrength">
          <div>
            Password strength: <span [style.color]="colorMapping[passwordStrength.score]">
            {{evaluationMapping[passwordStrength.score]}}</span>
          </div>
          <div>It could be guessed in {{passwordStrength.crack_times_display.offline_slow_hashing_1e4_per_second}}</div>
          <div>{{passwordStrength.feedback.warning}}</div>
          <div>{{passwordStrength.feedback.suggestions}}</div>
        </div>

        <div *ngIf="strengthError" class="error alert alert-danger" [innerHTML]="strengthError"></div>
      </div>

      <div class="form-group" [class.has-error]="matchError">
        <label for="passwordConfirm" hidden>Please enter your HAT password</label>
        <input type="password" class="form-control input-rump lg" id="passwordConfirm"
               (focus)="clearErrors()"
               ngModel name="passwordConfirm"
               placeholder="Confirm Password">

        <div *ngIf="matchError" class="error alert alert-danger">
          Provided passwords do not match.
        </div>
        <div *ngIf="successMessage" class="error alert alert-success">
          {{successMessage}}
        </div>
      </div>

      <div class="form-group">
        <button type="submit" class="btn btn-rump md fading">{{loadingText || "Change Password"}}</button>
      </div>
    </form>

    <div class="responsive password-guidance-box">
      Your data is precious â€“ keep it safe with a password that is <span class="password-highlight">Strong</span> or
      <span class="password-highlight">Very Strong</span> on this scale.<br><br>

      Example: <em>unicorn-coffee-taco</em><br><br>

      A combination of three random words is one of the strongest passwords you can set, and the kind we recommend.
      Read up on how we determine password strength policy (and why it's so important) over on our
      <a href="https://developers.hubofallthings.com/home/hat_service_provider/security_requirement_best_practice.html" target="_blank">developers' pages</a>.
    </div>
  </div>

</div>
